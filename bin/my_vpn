#!/usr/bin/bash
if [ "$EUID" -ne 0 ] 
then 
	echo "please run as root"
	exit 
fi

if [ "${1}" == "openvpn" ]; then
    mkdir -p /tmp/etc
    if [ -f "/tmp/etc/resolv.conf" ]; then
        systemctl stop openvpn-client@ant-lab
        mv /tmp/etc/resolv.conf /etc/resolv.conf
        echo "disconnect my openvpn"
    else
        if [ `systemctl is-active v2ray` == "active" ] ; then
            systemctl stop v2ray
        fi
        cp /etc/resolv.conf /tmp/etc/resolv.conf
        systemctl restart openvpn-client@ant-lab
        echo "# Generated by resolvconf" > /etc/resolv.conf
        echo "nameserver 10.8.0.1" >> /etc/resolv.conf
        echo "connect my openvpn"
    fi
	exit 0
fi

if [ "${1}" == "status" ]; then
	systemctl status openvpn-client@ant-lab
    echo "=== /etc/resolv.conf ==="
    cat /etc/resolv.conf
    echo "=== ip ==="
    ip a
	systemctl status v2ray
    exit 0
fi

if [ "${1}" == "v2ray" ]; then
    if [ `systemctl is-active v2ray` == "inactive" ] ; then
        if [ -f "/tmp/etc/resolv.conf" ]; then
            systemctl stop openvpn-client@ant-lab
            mv /tmp/etc/resolv.conf /etc/resolv.conf
            echo "disconnect my vpn"
        fi
        systemctl restart v2ray
        echo "connect my v2ray"
    else
        systemctl stop v2ray
        echo "disconnect my v2ray"
    fi
    exit 0
fi

echo "please give option status, openvpn, v2ray"
